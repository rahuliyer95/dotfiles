#!/usr/bin/env zsh

# Load path
for file in "$HOME/.rc.d/."{exports,path}; do
  [ -f "$file" ] && . "$file" 2> /dev/null
done
# Load the common shell dotfiles
for file in "$HOME/.rc.d/."{aliases,extras,functions}; do
  [ -f "$file" ] && . "$file" 2> /dev/null
done
for file in "$HOME/.zshrc.d/."{plugins.bundle,local.pre,zsh_prompt}; do
  [ -f "$file" ] && . "$file" 2> /dev/null
done

if [ -n "$(command -v brew 2> /dev/null)" ]; then
  PREFIX="$(brew --prefix bash-completion 2> /dev/null)"
  export BASH_COMPLETION_COMPAT_DIR="$PREFIX/etc/bash_completion.d"
  [ -d "$PREFIX" ] && . "$PREFIX/etc/profile.d/bash_completion.sh" 2> /dev/null
fi

# Custom completions
[ -d "$HOME/.zsh.d" ] \
  && fpath=("$HOME/.zsh.d" $fpath)


for option in appendhistory autocd autopushd incappendhistory histignorealldups histignorespace interactivecomments noextendedhistory sharehistory vi; do
  set -o "$option" 2> /dev/null
done

autoload -Uz +X add-zsh-hook cdr chpwd_recent_dirs compinit zmv
add-zsh-hook chpwd chpwd_recent_dirs
# zsh-completions
if [ -f "$HOME/.zcompdump" ] && [ "$(date +"%j")" != "$(stat -f "%Sm" -t "%j" "$HOME/.zcompdump")" ]; then
  compinit -d "$HOME/.zcompdump"
else
  compinit -C
fi

# Load bash-completions
autoload -Uz +X bashcompinit
bashcompinit

# zstyle ":completion:*" accept-exact "*(N)"
zstyle ":completion:*" use-cache on
zstyle ":completion:*" cache-path ~/.zsh/cache

# zsh-autosuggestions
export ZSH_AUTOSUGGEST_USE_ASYNC=true
export ZSH_AUTOSUGGEST_STRATEGY=(history match_prev_cmd completion)
export ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=60"
export ZSH_HIGHLIGHT_STYLES[comment]="fg=245"
bindkey "TAB" autosuggest-fetch
bindkey "^@" autosuggest-accept

autoload edit-command-line
zle -N edit-command-line
bindkey "^X^E" edit-command-line

# fzf widgets
[ -f "~/.fzf.zsh" ] && . "~/.fzf.zsh"
bindkey -a "/" fzf-insert-history
bindkey -a "?" fzf-insert-history
bindkey "^\\" fzf-change-recent-directory
bindkey "^r" fzf-insert-history
bindkey "^xf" fzf-insert-files
bindkey "^xd" fzf-insert-directory
bindkey "^xn" fzf-insert-named-directory

[ -f "$HOME/.zshrc.d/.local.post" ] && . "$HOME/.zshrc.d/.local.post"
